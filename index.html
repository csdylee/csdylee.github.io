<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>아이유 시계</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      width: 100vw;
      height: 100vh;
      background: #000000;
      color: #fff;
      font-family: 'Segoe UI', 'Pretendard', 'Apple SD Gothic Neo', Arial, sans-serif;
      overflow: hidden;
    }
    body {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      width: 100vw;
    }
    #clock-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 100vw;
      height: 100vh;
      user-select: none;
      cursor: pointer;
    }
    #date {
      font-size: 15vh;
      font-weight: 400;
      letter-spacing: 0.1em;
      margin-bottom: 2vh;
      opacity: 0.85;
      text-shadow: 0 2px 8px rgba(0,0,0,0.2);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    #time {
      font-size: 35vh;
      font-weight: 700;
      letter-spacing: 0.05em;
      text-shadow: 0 4px 24px rgba(0,0,0,0.3);
    }
    @media (max-width: 600px) {
      #date {
        font-size: 10vh;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      #time {
        font-size: 30vh;
      }
    }
    
    /* 태블릿 환경 최적화 (갤럭시탭 등) */
    @media (min-width: 601px) and (max-width: 1024px) {
      #date {
        font-size: 12vh;
        margin-bottom: 3vh;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        width: 100%;
        text-align: center;
      }
      #time {
        font-size: 32vh;
      }
    }
    
    /* 큰 태블릿 환경 (갤럭시탭 S9 등) */
    @media (min-width: 1025px) and (max-width: 1366px) {
      #date {
        font-size: 14vh;
        margin-bottom: 4vh;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        width: 100%;
        text-align: center;
      }
      #time {
        font-size: 36vh;
      }
    }
    
    /* PC 환경 최적화 (1367px 이상) */
    @media (min-width: 1367px) {
      #date {
        font-size: 15vh;
        margin-bottom: 2vh;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        width: 100%;
        text-align: center;
      }
      #time {
        font-size: 35vh;
      }
    }
  </style>
</head>
<body>
  <div id="clock-container">
    <div id="date"></div>
    <div id="time"></div>
  </div>
  <video id="keep-awake-video" loop playsinline style="position:absolute;left:0;top:0;width:0;height:0;opacity:0;">
    <source src="data:video/mp4;base64,AAAAHGZ0eXBtcDQyAAAAAG1wNDJpc29tYXZjMQAAAzRtb292AAAAbG12aGQAAAAAzaNacc2jWnEAAQAAAQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAGGlvZHMAAAAAEwAACAEAAAEAAAAAAAAAAAABAAAAAAEAAAAAAAEAAAAYc3RiawAAABxzdHNkAAAAAAAAAAEAAABhdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAABAAEAaaGF2YwEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAACgAAAAYc3R0cwAAAAAAAAABAAAAAQAAAAEAAAAUc3RzcwAAAAAAAAABAAAAAQAAABRzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAYc3RzegAAAAAAAAAAAAAAAQAAAAEAAAAUc3RjbwAAAAAAAAABAAAAMAAAABh1ZHRhAAAAFG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTguNzYuMTAw" type="video/mp4">
  </video>
  <script>
    // 메모리 누수 방지를 위한 정리 함수들
    var clockInterval = null;
    var clickTimeout = null;
    var touchStartTime = 0;
    var isDoubleTouch = false;
    var currentImageIndex = 0;
    var shuffledImageFiles = [];
    
    // 페이지 언로드 시 정리 함수
    function cleanup() {
      if (clockInterval) {
        clearInterval(clockInterval);
        clockInterval = null;
      }
      if (clickTimeout) {
        clearTimeout(clickTimeout);
        clickTimeout = null;
      }
    }
    
    // 페이지 언로드 이벤트 등록 (Android 5 호환)
    if (window.addEventListener) {
      window.addEventListener('beforeunload', cleanup, false);
      window.addEventListener('unload', cleanup, false);
    } else if (window.attachEvent) {
      window.attachEvent('onbeforeunload', cleanup);
      window.attachEvent('onunload', cleanup);
    }

    function updateClock() {
      try {
        var now = new Date();
        var dateEl = document.getElementById('date');
        var timeEl = document.getElementById('time');
        
        if (!dateEl || !timeEl) return; // 요소가 없으면 종료
        
        // Android 5 호환: 짧은 날짜 형식으로 표시
        var dateStr, timeStr;
        var year = now.getFullYear();
        var month = now.getMonth() + 1;
        var date = now.getDate();
        var hours = now.getHours();
        var minutes = now.getMinutes();
        
        // 요일 배열
        var weekdays = ['일', '월', '화', '수', '목', '금', '토'];
        var weekday = weekdays[now.getDay()];
        
        // 짧은 형식: "2024.09.06 금"
        dateStr = year + '.' + 
                 (month < 10 ? '0' : '') + month + '.' + 
                 (date < 10 ? '0' : '') + date + ' ' + weekday;
        
        timeStr = (hours < 10 ? '0' : '') + hours + ':' + (minutes < 10 ? '0' : '') + minutes;
        
        dateEl.textContent = dateStr;
        timeEl.textContent = timeStr;
      } catch (error) {
        console.log('시계 업데이트 오류:', error);
      }
    }
    
    clockInterval = setInterval(updateClock, 1000);
    updateClock();

    // 터치/클릭으로 다음 이미지로 변경 (변수는 상단에서 이미 선언됨)
    
    function handleImageChange() {
      if (!isDoubleTouch) {
        changeBackgroundImage();
      }
      isDoubleTouch = false;
    }
    
    // 터치 이벤트 처리 (모바일)
    document.getElementById('clock-container').addEventListener('touchstart', function(e) {
      touchStartTime = Date.now();
    }, false);
    
    document.getElementById('clock-container').addEventListener('touchend', function(e) {
      e.preventDefault(); // 클릭 이벤트 중복 방지
      var touchDuration = Date.now() - touchStartTime;
      
      // 짧은 터치만 이미지 변경 (더블탭 방지)
      if (touchDuration < 500) {
        if (clickTimeout) {
          clearTimeout(clickTimeout);
          isDoubleTouch = true; // 더블탭 감지
          toggleFullscreen();
        } else {
          clickTimeout = setTimeout(function() {
            handleImageChange();
            clickTimeout = null;
          }, 300);
        }
      }
    }, false);
    
    // 클릭 이벤트 처리 (PC)
    document.getElementById('clock-container').addEventListener('click', function(e) {
      // 터치 기기에서는 클릭 이벤트 무시
      if ('ontouchstart' in window) {
        return;
      }
      
      // 더블 클릭 이벤트와 충돌 방지
      if (e.detail === 1) {
        setTimeout(function() {
          if (e.detail === 1) {
            changeBackgroundImage();
          }
        }, 200);
      }
    });

    // 더블 클릭으로 전체화면 토글 (모바일 지원 포함)
    document.getElementById('clock-container').addEventListener('dblclick', function() {
      toggleFullscreen();
    });

    // 전체화면 토글 함수 (모바일 지원)
    function toggleFullscreen() {
      try {
        if (!document.fullscreenElement && 
            !document.webkitFullscreenElement && 
            !document.mozFullScreenElement && 
            !document.msFullscreenElement) {
          // 전체화면 진입
          if (document.documentElement.requestFullscreen) {
            document.documentElement.requestFullscreen();
          } else if (document.documentElement.webkitRequestFullscreen) {
            document.documentElement.webkitRequestFullscreen();
          } else if (document.documentElement.mozRequestFullScreen) {
            document.documentElement.mozRequestFullScreen();
          } else if (document.documentElement.msRequestFullscreen) {
            document.documentElement.msRequestFullscreen();
          }
        } else {
          // 전체화면 종료
          if (document.exitFullscreen) {
            document.exitFullscreen();
          } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
          } else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
          } else if (document.msExitFullscreen) {
            document.msExitFullscreen();
          }
        }
      } catch (error) {
        console.log('전체화면 전환 실패:', error);
        // 모바일에서 전체화면이 지원되지 않는 경우 대안 제공
        if (window.innerHeight === screen.height) {
          // 이미 전체화면 상태라면 종료 시도
          window.scrollTo(0, 0);
        }
      }
    }



    // 폰트 크기 자동 조정 (반응형)
    function resizeFont() {
      // clamp 사용으로 CSS에서 이미 반응형 처리됨
      // 필요시 추가 조정 가능
    }
    if (window.addEventListener) {
      window.addEventListener('resize', resizeFont, false);
    } else if (window.attachEvent) {
      window.attachEvent('onresize', resizeFont);
    }
    resizeFont();

    // 로컬 이미지 배경 변경 기능 (변수는 상단에서 이미 선언됨)
    var imageFiles = [
      '0aeb0a18e5164f02ab8.jpg',
      '1341d5f0a7591.jpg',
      '14780ee505d728.jpg',
      '14786ca31eff24.jpg',
      '14786fe712f66a.jpg',
      '1478774f5546f2.jpg',
      '14787ac8772fb1.jpg',
      '152eb29ec7d803.jpg',
      '152f175644215c.jpg',
      '152f1785ae2cfe.jpg',
      '153f629cea75d0.jpg',
      '16892014d69921.jpg',
      '1a0961b0641166.png',
      '21a6f0b3b9136f.jpg',
      '21a6f3ad82d011.jpg',
      '21a6f62d2391dd.jpg',
      '21aab11d0aed00.jpg',
      '225af8c0fefb4c.jpg',
      '2421e7b87441f7.jpeg',
      '285e8fcebfd55a.jpeg',
      '2a27413b0b338b.jpeg',
      '2a4bcf55b49235.jpeg',
      '2a4bd0e640e96d.jpeg',
      '2a4c3cfe93f7b8.jpeg',
      '2a4c3dd2e42fe3.jpeg',
      '2fdf43751f9fa4.jpg',
      '2fdf46d7df742a.jpg',
      '2fdf517cbabdf7.jpg',
      '2fdfaec0383dd5.jpg',
      '2fdfb23dbe5763.jpg',
      '3b8c8172b7aa4571ad6.jpg',
      '4018aa41953336.jpg',
      '533313b594c66e.jpeg',
      '53331aaf050096.jpeg',
      '53331dc97f41ad.jpeg',
      '533324d381b8f8.jpeg',
      '5336db56a46fb2.jpeg',
      '5336ded4cd4766.jpeg',
      '5336e54699fdce.jpeg',
      '534a7ca30e49452fad0.png',
      '6012237169c38a.png',
      '7d4d3025de8973.jpg',
      '868d684abf66a.jpg',
      '868e405f015de.jpg',
      'e6c6226acc93a.jpeg'
    ];

    // 이미지 배열을 섞는 함수 (Fisher-Yates 알고리즘)
    function shuffleArray(array) {
      var shuffled = array.slice(); // 배열 복사
      for (var i = shuffled.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        var temp = shuffled[i];
        shuffled[i] = shuffled[j];
        shuffled[j] = temp;
      }
      return shuffled;
    }

    function changeBackgroundImage() {
      try {
        if (!shuffledImageFiles || shuffledImageFiles.length === 0) {
          console.log('이미지 파일 목록이 없습니다.');
          return;
        }
        
        var imageFile = shuffledImageFiles[currentImageIndex];
        var imagePath = 'images/' + imageFile;
        
        // Android 5 호환: 템플릿 리터럴 대신 문자열 연결 사용
        document.body.style.backgroundImage = 'linear-gradient(135deg, rgba(0, 0, 0, 0.3) 0%, rgba(0, 0, 0, 0.3) 100%), url(\'' + imagePath + '\')';
        document.body.style.backgroundSize = 'cover';
        document.body.style.backgroundPosition = 'center';
        document.body.style.backgroundRepeat = 'no-repeat';
        
        console.log('배경 이미지 변경: ' + imageFile);
        
        // 다음 이미지 인덱스로 이동 (메모리 누수 방지를 위한 안전한 증가)
        currentImageIndex = (currentImageIndex + 1) % shuffledImageFiles.length;
      } catch (error) {
        console.log('배경 이미지 변경 중 오류:', error);
      }
    }


    // 페이지 로드 시 이미지 배열을 섞기
    try {
      shuffledImageFiles = shuffleArray(imageFiles);
      console.log('섞인 이미지 순서:', shuffledImageFiles);
      
      // 초기 배경 이미지 설정
      changeBackgroundImage();
    } catch (error) {
      console.log('이미지 초기화 중 오류:', error);
    }


    // 절전 모드 방지용 비디오 재생 (Android 5 호환)
    function playKeepAwakeVideo() {
      var video = document.getElementById('keep-awake-video');
      if (video) {
        try {
          // Android 5 호환: 프로미스 지원 확인
          var playPromise = video.play();
          if (playPromise && typeof playPromise.then === 'function') {
            // 프로미스를 지원하는 경우
            playPromise.then(function() {
              console.log('절전 모드 방지 비디오 재생 시작.');
            }).catch(function(error) {
              console.log('절전 모드 방지 비디오 자동 재생 실패:', error);
              // Android 5 호환: 한 번만 실행되는 이벤트 리스너 수동 구현
              var playOnce = function() {
                video.play();
                document.body.removeEventListener('click', playOnce);
                document.body.removeEventListener('touchend', playOnce);
              };
              document.body.addEventListener('click', playOnce);
              document.body.addEventListener('touchend', playOnce);
            });
          } else {
            // 프로미스를 지원하지 않는 구형 브라우저
            console.log('절전 모드 방지 비디오 재생 시작.');
          }
        } catch (error) {
          console.log('비디오 재생 중 오류:', error);
        }
      }
    }
    
    // 페이지 로드 시 비디오 재생 시도
    playKeepAwakeVideo();
  </script>
</body>
</html>